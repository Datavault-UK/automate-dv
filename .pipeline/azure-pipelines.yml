trigger:
  batch: true
  branches:
    include:
      - develop
      - stage/*
    exclude:
      - feat/*

pool:
  vmImage: ubuntu-latest

variables:
  PIPELINE_BRANCH: $(Build.SourceBranchName)

resources:
  containers:
    - container: mssql
      image: mcr.microsoft.com/mssql/server:2019-latest
      ports:
        - 1433:1433
      options: --user 0
      env:
        ACCEPT_EULA: Y
        MSSQL_SA_PASSWORD: SlA7Qs3w!O
        MSSQL_PID: Developer

stages:
  - stage: 'unit_tests'
    displayName: 'Unit Tests'
    jobs:
      - job: 'harness_tests'
        displayName: 'Harness Unit Tests'
        steps:
          - task: UsePythonVersion@0
            inputs:
              versionSpec: '3.9'
          - template: templates/install-dependencies-steps.yml
          - script: inv setup -p snowflake -e pipeline
            displayName: "Setup harness"
          - script: inv run-harness-tests -p snowflake
            displayName: "Run harness tests"

      - job: 'macro_tests_sf'
        displayName: 'Macro Unit Tests - Snowflake'
        steps:
          - task: UsePythonVersion@0
            inputs:
              versionSpec: '3.9'
          - template: templates/install-dependencies-steps.yml
          - script: inv setup -p snowflake -e pipeline
            displayName: "Setup harness"
          - script: inv run-dbt "run-operation drop_all_custom_schemas" -p snowflake
            displayName: "Drop all custom schemas"
          - script: inv run-macro-tests -p snowflake
            displayName: "Run macro tests"
            env:
              PIPELINE_JOB: $(Agent.JobName)

  - stage: 'integration_tests_sqlserver'
    displayName: 'Run Integration Tests (MS SQL Server)'
    jobs:
      - job: 'staging'
        displayName: 'Staging'
        services:
          mssql: mssql
        steps:
          - task: UsePythonVersion@0
            inputs:
              versionSpec: '3.9'
          - template: templates/install-deps-setup-sqlserver-steps.yml
          - template: templates/install-dependencies-steps.yml
          - script: inv setup -p sqlserver -e pipeline
            displayName: "Setup harness"
          - script: inv run-integration-tests -s staging -p sqlserver
            displayName: "Run feature files"
            env:
              PIPELINE_JOB: $(Agent.JobName)

      - job: 'hubs_main'
        displayName: 'Hubs Main'
        services:
          mssql: mssql
        steps:
          - task: UsePythonVersion@0
            inputs:
              versionSpec: '3.9'
          - template: templates/install-deps-setup-sqlserver-steps.yml
          - template: templates/install-dependencies-steps.yml
          - script: inv setup -p sqlserver -e pipeline
            displayName: "Setup harness"
          - script: inv run-integration-tests -s hubs --subtype main -p sqlserver
            displayName: "Run feature files"
            env:
              PIPELINE_JOB: $(Agent.JobName)

      - job: 'hubs_comppk'
        displayName: 'Hubs Comp PK'
        services:
          mssql: mssql
        steps:
          - task: UsePythonVersion@0
            inputs:
              versionSpec: '3.9'
          - template: templates/install-deps-setup-sqlserver-steps.yml
          - template: templates/install-dependencies-steps.yml
          - script: inv setup -p sqlserver -e pipeline
            displayName: "Setup harness"
          - script: inv run-integration-tests -s hubs --subtype comppk -p sqlserver
            displayName: "Run feature files"
            env:
              PIPELINE_JOB: $(Agent.JobName)

      - job: 'hubs_incremental'
        displayName: 'Hubs Incremental'
        services:
          mssql: mssql
        steps:
          - task: UsePythonVersion@0
            inputs:
              versionSpec: '3.9'
          - template: templates/install-deps-setup-sqlserver-steps.yml
          - template: templates/install-dependencies-steps.yml
          - script: inv setup -p sqlserver -e pipeline
            displayName: "Setup harness"
          - script: inv run-integration-tests -s hubs --subtype incremental -p sqlserver
            displayName: "Run feature files"
            env:
              PIPELINE_JOB: $(Agent.JobName)

      - job: 'hubs_pm'
        displayName: 'Hubs PM'
        services:
          mssql: mssql
        steps:
          - task: UsePythonVersion@0
            inputs:
              versionSpec: '3.9'
          - template: templates/install-deps-setup-sqlserver-steps.yml
          - template: templates/install-dependencies-steps.yml
          - script: inv setup -p sqlserver -e pipeline
            displayName: "Setup harness"
          - script: inv run-integration-tests -s hubs --subtype pm -p sqlserver
            displayName: "Run feature files"
            env:
              PIPELINE_JOB: $(Agent.JobName)

      - job: 'hubs_rm'
        displayName: 'Hubs RM'
        services:
          mssql: mssql
        steps:
          - task: UsePythonVersion@0
            inputs:
              versionSpec: '3.9'
          - template: templates/install-deps-setup-sqlserver-steps.yml
          - template: templates/install-dependencies-steps.yml
          - script: inv setup -p sqlserver -e pipeline
            displayName: "Setup harness"
          - script: inv run-integration-tests -s hubs --subtype rank -p sqlserver
            displayName: "Run feature files"
            env:
              PIPELINE_JOB: $(Agent.JobName)

      - job: 'links_main'
        displayName: 'Links Main'
        services:
          mssql: mssql
        steps:
          - task: UsePythonVersion@0
            inputs:
              versionSpec: '3.9'
          - template: templates/install-deps-setup-sqlserver-steps.yml
          - template: templates/install-dependencies-steps.yml
          - script: inv setup -p sqlserver -e pipeline
            displayName: "Setup harness"
          - script: inv run-integration-tests -s links --subtype main -p sqlserver
            displayName: "Run feature files"
            env:
              PIPELINE_JOB: $(Agent.JobName)

      - job: 'links_incremental'
        displayName: 'Links Incremental'
        services:
          mssql: mssql
        steps:
          - task: UsePythonVersion@0
            inputs:
              versionSpec: '3.9'
          - template: templates/install-deps-setup-sqlserver-steps.yml
          - template: templates/install-dependencies-steps.yml
          - script: inv setup -p sqlserver -e pipeline
            displayName: "Setup harness"
          - script: inv run-integration-tests -s links --subtype incremental -p sqlserver
            displayName: "Run feature files"
            env:
              PIPELINE_JOB: $(Agent.JobName)

      - job: 'links_pm'
        displayName: 'Links PM'
        services:
          mssql: mssql
        steps:
          - task: UsePythonVersion@0
            inputs:
              versionSpec: '3.9'
          - template: templates/install-deps-setup-sqlserver-steps.yml
          - template: templates/install-dependencies-steps.yml
          - script: inv setup -p sqlserver -e pipeline
            displayName: "Setup harness"
          - script: inv run-integration-tests -s links --subtype pm -p sqlserver
            displayName: "Run feature files"
            env:
              PIPELINE_JOB: $(Agent.JobName)

      - job: 'links_rm'
        displayName: 'Links RM'
        services:
          mssql: mssql
        steps:
          - task: UsePythonVersion@0
            inputs:
              versionSpec: '3.9'
          - template: templates/install-deps-setup-sqlserver-steps.yml
          - template: templates/install-dependencies-steps.yml
          - script: inv setup -p sqlserver -e pipeline
            displayName: "Setup harness"
          - script: inv run-integration-tests -s links --subtype rank -p sqlserver
            displayName: "Run feature files"
            env:
              PIPELINE_JOB: $(Agent.JobName)

      - job: 'tlinks'
        displayName: 'TLinks'
        services:
          mssql: mssql
        steps:
          - task: UsePythonVersion@0
            inputs:
              versionSpec: '3.9'
          - template: templates/install-deps-setup-sqlserver-steps.yml
          - template: templates/install-dependencies-steps.yml
          - script: inv setup -p sqlserver -e pipeline
            displayName: "Setup harness"
          - script: inv run-integration-tests -s t_links -p sqlserver
            displayName: "Run feature files"
            env:
              PIPELINE_JOB: $(Agent.JobName)

      - job: 'sats_main'
        displayName: 'Sats Main'
        services:
          mssql: mssql
        steps:
          - task: UsePythonVersion@0
            inputs:
              versionSpec: '3.9'
          - template: templates/install-deps-setup-sqlserver-steps.yml
          - template: templates/install-dependencies-steps.yml
          - script: inv setup -p sqlserver -e pipeline
            displayName: "Setup harness"
          - script: inv run-integration-tests -s sats --subtype main -p sqlserver
            displayName: "Run feature files"
            env:
              PIPELINE_JOB: $(Agent.JobName)

      - job: 'sats_cycles'
        displayName: 'Sats Cycles'
        services:
          mssql: mssql
        steps:
          - task: UsePythonVersion@0
            inputs:
              versionSpec: '3.9'
          - template: templates/install-deps-setup-sqlserver-steps.yml
          - template: templates/install-dependencies-steps.yml
          - script: inv setup -p sqlserver -e pipeline
            displayName: "Setup harness"
          - script: inv run-integration-tests -s sats --subtype cycles -p sqlserver
            displayName: "Run feature files"
            env:
              PIPELINE_JOB: $(Agent.JobName)

      - job: 'sats_incremental'
        displayName: 'Sats Incremental'
        services:
          mssql: mssql
        steps:
          - task: UsePythonVersion@0
            inputs:
              versionSpec: '3.9'
          - template: templates/install-deps-setup-sqlserver-steps.yml
          - template: templates/install-dependencies-steps.yml
          - script: inv setup -p sqlserver -e pipeline
            displayName: "Setup harness"
          - script: inv run-integration-tests -s sats --subtype incremental -p sqlserver
            displayName: "Run feature files"
            env:
              PIPELINE_JOB: $(Agent.JobName)

      - job: 'sats_pm'
        displayName: 'Sats PM'
        services:
          mssql: mssql
        steps:
          - task: UsePythonVersion@0
            inputs:
              versionSpec: '3.9'
          - template: templates/install-deps-setup-sqlserver-steps.yml
          - template: templates/install-dependencies-steps.yml
          - script: inv setup -p sqlserver -e pipeline
            displayName: "Setup harness"
          - script: inv run-integration-tests -s sats --subtype pm -p sqlserver
            displayName: "Run feature files"
            env:
              PIPELINE_JOB: $(Agent.JobName)

      - job: 'sats_rm'
        displayName: 'Sats RM'
        services:
          mssql: mssql
        steps:
          - task: UsePythonVersion@0
            inputs:
              versionSpec: '3.9'
          - template: templates/install-deps-setup-sqlserver-steps.yml
          - template: templates/install-dependencies-steps.yml
          - script: inv setup -p sqlserver -e pipeline
            displayName: "Setup harness"
          - script: inv run-integration-tests -s sats --subtype rank -p sqlserver
            displayName: "Run feature files"
            env:
              PIPELINE_JOB: $(Agent.JobName)

      - job: 'eff_sats_main'
        displayName: 'Eff Sats Main'
        services:
          mssql: mssql
        steps:
          - task: UsePythonVersion@0
            inputs:
              versionSpec: '3.9'
          - template: templates/install-deps-setup-sqlserver-steps.yml
          - template: templates/install-dependencies-steps.yml
          - script: inv setup -p sqlserver -e pipeline
            displayName: "Setup harness"
          - script: inv run-integration-tests -s eff_sats --subtype main -p sqlserver
            displayName: "Run feature files"
            env:
              PIPELINE_JOB: $(Agent.JobName)

      - job: 'eff_sats_auto'
        displayName: 'Eff Sats Auto'
        services:
          mssql: mssql
        steps:
          - task: UsePythonVersion@0
            inputs:
              versionSpec: '3.9'
          - template: templates/install-deps-setup-sqlserver-steps.yml
          - template: templates/install-dependencies-steps.yml
          - script: inv setup -p sqlserver -e pipeline
            displayName: "Setup harness"
          - script: inv run-integration-tests -s eff_sats --subtype auto -p sqlserver
            displayName: "Run feature files"
            env:
              PIPELINE_JOB: $(Agent.JobName)

      - job: 'eff_sats_disabled'
        displayName: 'Eff Sats Disabled Auto End-dating'
        services:
          mssql: mssql
        steps:
          - task: UsePythonVersion@0
            inputs:
              versionSpec: '3.9'
          - template: templates/install-deps-setup-sqlserver-steps.yml
          - template: templates/install-dependencies-steps.yml
          - script: inv setup -p sqlserver -e pipeline
            displayName: "Setup harness"
          - script: inv run-integration-tests -s eff_sats --subtype disabled -p sqlserver
            displayName: "Run feature files"
            env:
              PIPELINE_JOB: $(Agent.JobName)

      - job: 'eff_sats_mat'
        displayName: 'Eff Sats Mat'
        services:
          mssql: mssql
        steps:
          - task: UsePythonVersion@0
            inputs:
              versionSpec: '3.9'
          - template: templates/install-deps-setup-sqlserver-steps.yml
          - template: templates/install-dependencies-steps.yml
          - script: inv setup -p sqlserver -e pipeline
            displayName: "Setup harness"
          - script: inv run-integration-tests -s eff_sats --subtype mat -p sqlserver
            displayName: "Run feature files"
            env:
              PIPELINE_JOB: $(Agent.JobName)

      - job: 'ma_sats_1cdk'
        displayName: 'MA Sats 1CDK'
        services:
          mssql: mssql
        steps:
          - task: UsePythonVersion@0
            inputs:
              versionSpec: '3.9'
          - template: templates/install-deps-setup-sqlserver-steps.yml
          - template: templates/install-dependencies-steps.yml
          - script: inv setup -p sqlserver -e pipeline
            displayName: "Setup harness"
          - script: inv run-integration-tests -s ma_sats --subtype 1cdk -p sqlserver
            displayName: "Run feature files"
            env:
              PIPELINE_JOB: $(Agent.JobName)

      - job: 'ma_sats_1cdk_cyc'
        displayName: 'MA Sats 1CDK-Cycles'
        services:
          mssql: mssql
        steps:
          - task: UsePythonVersion@0
            inputs:
              versionSpec: '3.9'
          - template: templates/install-deps-setup-sqlserver-steps.yml
          - template: templates/install-dependencies-steps.yml
          - script: inv setup -p sqlserver -e pipeline
            displayName: "Setup harness"
          - script: inv run-integration-tests -s ma_sats --subtype 1cdk_cycles -p sqlserver
            displayName: "Run feature files"
            env:
              PIPELINE_JOB: $(Agent.JobName)

      - job: 'ma_sats_2cdk'
        displayName: 'MA Sats 2CDK'
        services:
          mssql: mssql
        steps:
          - task: UsePythonVersion@0
            inputs:
              versionSpec: '3.9'
          - template: templates/install-deps-setup-sqlserver-steps.yml
          - template: templates/install-dependencies-steps.yml
          - script: inv setup -p sqlserver -e pipeline
            displayName: "Setup harness"
          - script: inv run-integration-tests -s ma_sats --subtype 2cdk -p sqlserver
            displayName: "Run feature files"
            env:
              PIPELINE_JOB: $(Agent.JobName)

      - job: 'ma_sats_2cdk_cyc'
        displayName: 'MA Sats 2CDK-Cycles'
        services:
          mssql: mssql
        steps:
          - task: UsePythonVersion@0
            inputs:
              versionSpec: '3.9'
          - template: templates/install-deps-setup-sqlserver-steps.yml
          - template: templates/install-dependencies-steps.yml
          - script: inv setup -p sqlserver -e pipeline
            displayName: "Setup harness"
          - script: inv run-integration-tests -s ma_sats --subtype 2cdk_cycles -p sqlserver
            displayName: "Run feature files"
            env:
              PIPELINE_JOB: $(Agent.JobName)

      - job: 'ma_sats_incremental'
        displayName: 'MA Sats Incremental'
        services:
          mssql: mssql
        steps:
          - task: UsePythonVersion@0
            inputs:
              versionSpec: '3.9'
          - template: templates/install-deps-setup-sqlserver-steps.yml
          - template: templates/install-dependencies-steps.yml
          - script: inv setup -p sqlserver -e pipeline
            displayName: "Setup harness"
          - script: inv run-integration-tests -s ma_sats --subtype incremental -p sqlserver
            displayName: "Run feature files"
            env:
              PIPELINE_JOB: $(Agent.JobName)

      - job: 'ma_sats_pm'
        displayName: 'MA Sats PM'
        services:
          mssql: mssql
        steps:
          - task: UsePythonVersion@0
            inputs:
              versionSpec: '3.9'
          - template: templates/install-deps-setup-sqlserver-steps.yml
          - template: templates/install-dependencies-steps.yml
          - script: inv setup -p sqlserver -e pipeline
            displayName: "Setup harness"
          - script: inv run-integration-tests -s ma_sats --subtype pm -p sqlserver
            displayName: "Run feature files"
            env:
              PIPELINE_JOB: $(Agent.JobName)

      - job: 'ma_sats_rm'
        displayName: 'MA Sats RM'
        services:
          mssql: mssql
        steps:
          - task: UsePythonVersion@0
            inputs:
              versionSpec: '3.9'
          - template: templates/install-deps-setup-sqlserver-steps.yml
          - template: templates/install-dependencies-steps.yml
          - script: inv setup -p sqlserver -e pipeline
            displayName: "Setup harness"
          - script: inv run-integration-tests -s ma_sats --subtype rm -p sqlserver
            displayName: "Run feature files"
            env:
              PIPELINE_JOB: $(Agent.JobName)

      - job: 'ma_sats_rm_dup'
        displayName: 'MA Sats RM Duplicates'
        services:
          mssql: mssql
        steps:
          - task: UsePythonVersion@0
            inputs:
              versionSpec: '3.9'
          - template: templates/install-deps-setup-sqlserver-steps.yml
          - template: templates/install-dependencies-steps.yml
          - script: inv setup -p sqlserver -e pipeline
            displayName: "Setup harness"
          - script: inv run-integration-tests -s ma_sats --subtype rm_dup -p sqlserver
            displayName: "Run feature files"
            env:
              PIPELINE_JOB: $(Agent.JobName)

      - job: 'xts_main'
        displayName: 'XT Sats - Main'
        services:
          mssql: mssql
        steps:
          - task: UsePythonVersion@0
            inputs:
              versionSpec: '3.9'
          - template: templates/install-deps-setup-sqlserver-steps.yml
          - template: templates/install-dependencies-steps.yml
          - script: inv setup -p sqlserver -e pipeline
            displayName: "Setup harness"
          - script: inv run-integration-tests -s xts --subtype main -p sqlserver
            displayName: "Run feature files"
            env:
              PIPELINE_JOB: $(Agent.JobName)

      - job: 'xts_inc'
        displayName: 'XT Sats - Incremental'
        services:
          mssql: mssql
        steps:
          - task: UsePythonVersion@0
            inputs:
              versionSpec: '3.9'
          - template: templates/install-deps-setup-sqlserver-steps.yml
          - template: templates/install-dependencies-steps.yml
          - script: inv setup -p sqlserver -e pipeline
            displayName: "Setup harness"
          - script: inv run-integration-tests -s xts --subtype incremental -p sqlserver
            displayName: "Run feature files"
            env:
              PIPELINE_JOB: $(Agent.JobName)

      - job: 'pit_main'
        displayName: 'PITs Main'
        services:
          mssql: mssql
        steps:
          - task: UsePythonVersion@0
            inputs:
              versionSpec: '3.9'
          - template: templates/install-deps-setup-sqlserver-steps.yml
          - template: templates/install-dependencies-steps.yml
          - script: inv setup -p sqlserver -e pipeline
            displayName: "Setup harness"
          - script: inv run-integration-tests -s pit --subtype main -p sqlserver
            displayName: "Run feature files"
            env:
              PIPELINE_JOB: $(Agent.JobName)

      - job: 'pit_1sat_base'
        displayName: 'PITs 1 Sat Base'
        services:
          mssql: mssql
        steps:
          - task: UsePythonVersion@0
            inputs:
              versionSpec: '3.9'
          - template: templates/install-deps-setup-sqlserver-steps.yml
          - template: templates/install-dependencies-steps.yml
          - script: inv setup -p sqlserver -e pipeline
            displayName: "Setup harness"
          - script: inv run-integration-tests -s pit --subtype 1sat_base -p sqlserver
            displayName: "Run feature files"
            env:
              PIPELINE_JOB: $(Agent.JobName)

      - job: 'pit_1sat_inc'
        displayName: 'PITs 1 Sat Incremental'
        services:
          mssql: mssql
        steps:
          - task: UsePythonVersion@0
            inputs:
              versionSpec: '3.9'
          - template: templates/install-deps-setup-sqlserver-steps.yml
          - template: templates/install-dependencies-steps.yml
          - script: inv setup -p sqlserver -e pipeline
            displayName: "Setup harness"
          - script: inv run-integration-tests -s pit --subtype 1sat_inc -p sqlserver
            displayName: "Run feature files"
            env:
              PIPELINE_JOB: $(Agent.JobName)

      - job: 'pit_2sat'
        displayName: 'PITs 2 Sat'
        services:
          mssql: mssql
        steps:
          - task: UsePythonVersion@0
            inputs:
              versionSpec: '3.9'
          - template: templates/install-deps-setup-sqlserver-steps.yml
          - template: templates/install-dependencies-steps.yml
          - script: inv setup -p sqlserver -e pipeline
            displayName: "Setup harness"
          - script: inv run-integration-tests -s pit --subtype 2sat -p sqlserver
            displayName: "Run feature files"
            env:
              PIPELINE_JOB: $(Agent.JobName)

      - job: 'bridge_inc'
        displayName: 'Bridges Incremental'
        services:
          mssql: mssql
        steps:
          - task: UsePythonVersion@0
            inputs:
              versionSpec: '3.9'
          - template: templates/install-deps-setup-sqlserver-steps.yml
          - template: templates/install-dependencies-steps.yml
          - script: inv setup -p sqlserver -e pipeline
            displayName: "Setup harness"
          - script: inv run-integration-tests -s bridge --subtype inc -p sqlserver
            displayName: "Run feature files"
            env:
              PIPELINE_JOB: $(Agent.JobName)

      - job: 'bridge_1link'
        displayName: 'Bridges 1Link'
        services:
          mssql: mssql
        steps:
          - task: UsePythonVersion@0
            inputs:
              versionSpec: '3.9'
          - template: templates/install-deps-setup-sqlserver-steps.yml
          - template: templates/install-dependencies-steps.yml
          - script: inv setup -p sqlserver -e pipeline
            displayName: "Setup harness"
          - script: inv run-integration-tests -s bridge --subtype 1link -p sqlserver
            displayName: "Run feature files"
            env:
              PIPELINE_JOB: $(Agent.JobName)

      - job: 'bridge_2link'
        displayName: 'Bridges 2Link'
        services:
          mssql: mssql
        steps:
          - task: UsePythonVersion@0
            inputs:
              versionSpec: '3.9'
          - template: templates/install-deps-setup-sqlserver-steps.yml
          - template: templates/install-dependencies-steps.yml
          - script: inv setup -p sqlserver -e pipeline
            displayName: "Setup harness"
          - script: inv run-integration-tests -s bridge --subtype 2link -p sqlserver
            displayName: "Run feature files"
            env:
              PIPELINE_JOB: $(Agent.JobName)

      - job: 'bridge_3link'
        displayName: 'Bridges 3Link'
        services:
          mssql: mssql
        steps:
          - task: UsePythonVersion@0
            inputs:
              versionSpec: '3.9'
          - template: templates/install-deps-setup-sqlserver-steps.yml
          - template: templates/install-dependencies-steps.yml
          - script: inv setup -p sqlserver -e pipeline
            displayName: "Setup harness"
          - script: inv run-integration-tests -s bridge --subtype 3link -p sqlserver
            displayName: "Run feature files"
            env:
              PIPELINE_JOB: $(Agent.JobName)

      - job: 'cycle'
        displayName: 'Cycles'
        services:
          mssql: mssql
        steps:
          - task: UsePythonVersion@0
            inputs:
              versionSpec: '3.9'
          - template: templates/install-deps-setup-sqlserver-steps.yml
          - template: templates/install-dependencies-steps.yml
          - script: inv setup -p sqlserver -e pipeline
            displayName: "Setup harness"
          - script: inv run-integration-tests -s cycle -p sqlserver
            displayName: "Run feature files"
            env:
              PIPELINE_JOB: $(Agent.JobName)

  - stage: 'integration_tests_snowflake'
    displayName: 'Run Integration Tests (Snowflake)'
    jobs:
      - job: 'staging'
        displayName: 'Staging'
        steps:
          - task: UsePythonVersion@0
            inputs:
              versionSpec: '3.9'
          - template: templates/install-dependencies-steps.yml
          - script: inv setup -p snowflake -e pipeline
            displayName: "Setup harness"
          - script: inv run-integration-tests -s staging -p snowflake
            displayName: "Run feature files"
            env:
              PIPELINE_JOB: $(Agent.JobName)

      - job: 'hubs_main'
        displayName: 'Hubs Main'
        steps:
          - task: UsePythonVersion@0
            inputs:
              versionSpec: '3.9'
          - template: templates/install-dependencies-steps.yml
          - script: inv setup -p snowflake -e pipeline
            displayName: "Setup harness"
          - script: inv run-integration-tests -s hubs --subtype main -p snowflake
            displayName: "Run feature files"
            env:
              PIPELINE_JOB: $(Agent.JobName)

      - job: 'hubs_comppk'
        displayName: 'Hubs Comp PK'
        steps:
          - task: UsePythonVersion@0
            inputs:
              versionSpec: '3.9'
          - template: templates/install-dependencies-steps.yml
          - script: inv setup -p snowflake -e pipeline
            displayName: "Setup harness"
          - script: inv run-integration-tests -s hubs --subtype comppk -p snowflake
            displayName: "Run feature files"
            env:
              PIPELINE_JOB: $(Agent.JobName)

      - job: 'hubs_incremental'
        displayName: 'Hubs Incremental'
        steps:
          - task: UsePythonVersion@0
            inputs:
              versionSpec: '3.9'
          - template: templates/install-dependencies-steps.yml
          - script: inv setup -p snowflake -e pipeline
            displayName: "Setup harness"
          - script: inv run-integration-tests -s hubs --subtype incremental -p snowflake
            displayName: "Run feature files"
            env:
              PIPELINE_JOB: $(Agent.JobName)

      - job: 'hubs_pm'
        displayName: 'Hubs PM'
        steps:
          - task: UsePythonVersion@0
            inputs:
              versionSpec: '3.9'
          - template: templates/install-dependencies-steps.yml
          - script: inv setup -p snowflake -e pipeline
            displayName: "Setup harness"
          - script: inv run-integration-tests -s hubs --subtype pm -p snowflake
            displayName: "Run feature files"
            env:
              PIPELINE_JOB: $(Agent.JobName)

      - job: 'hubs_rm'
        displayName: 'Hubs RM'
        steps:
          - task: UsePythonVersion@0
            inputs:
              versionSpec: '3.9'
          - template: templates/install-dependencies-steps.yml
          - script: inv setup -p snowflake -e pipeline
            displayName: "Setup harness"
          - script: inv run-integration-tests -s hubs --subtype rank -p snowflake
            displayName: "Run feature files"
            env:
              PIPELINE_JOB: $(Agent.JobName)

      - job: 'links_main'
        displayName: 'Links Main'
        steps:
          - task: UsePythonVersion@0
            inputs:
              versionSpec: '3.9'
          - template: templates/install-dependencies-steps.yml
          - script: inv setup -p snowflake -e pipeline
            displayName: "Setup harness"
          - script: inv run-integration-tests -s links --subtype main -p snowflake
            displayName: "Run feature files"
            env:
              PIPELINE_JOB: $(Agent.JobName)

      - job: 'links_incremental'
        displayName: 'Links Incremental'
        steps:
          - task: UsePythonVersion@0
            inputs:
              versionSpec: '3.9'
          - template: templates/install-dependencies-steps.yml
          - script: inv setup -p snowflake -e pipeline
            displayName: "Setup harness"
          - script: inv run-integration-tests -s links --subtype incremental -p snowflake
            displayName: "Run feature files"
            env:
              PIPELINE_JOB: $(Agent.JobName)

      - job: 'links_pm'
        displayName: 'Links PM'
        steps:
          - task: UsePythonVersion@0
            inputs:
              versionSpec: '3.9'
          - template: templates/install-dependencies-steps.yml
          - script: inv setup -p snowflake -e pipeline
            displayName: "Setup harness"
          - script: inv run-integration-tests -s links --subtype pm -p snowflake
            displayName: "Run feature files"
            env:
              PIPELINE_JOB: $(Agent.JobName)

      - job: 'links_rm'
        displayName: 'Links RM'
        steps:
          - task: UsePythonVersion@0
            inputs:
              versionSpec: '3.9'
          - template: templates/install-dependencies-steps.yml
          - script: inv setup -p snowflake -e pipeline
            displayName: "Setup harness"
          - script: inv run-integration-tests -s links --subtype rank -p snowflake
            displayName: "Run feature files"
            env:
              PIPELINE_JOB: $(Agent.JobName)

      - job: 'tlinks'
        displayName: 'TLinks'
        steps:
          - task: UsePythonVersion@0
            inputs:
              versionSpec: '3.9'
          - template: templates/install-dependencies-steps.yml
          - script: inv setup -p snowflake -e pipeline
            displayName: "Setup harness"
          - script: inv run-integration-tests -s t_links -p snowflake
            displayName: "Run feature files"
            env:
              PIPELINE_JOB: $(Agent.JobName)

      - job: 'sats_main'
        displayName: 'Sats Main'
        steps:
          - task: UsePythonVersion@0
            inputs:
              versionSpec: '3.9'
          - template: templates/install-dependencies-steps.yml
          - script: inv setup -p snowflake -e pipeline
            displayName: "Setup harness"
          - script: inv run-integration-tests -s sats --subtype main -p snowflake
            displayName: "Run feature files"
            env:
              PIPELINE_JOB: $(Agent.JobName)

      - job: 'sats_cycles'
        displayName: 'Sats Cycles'
        steps:
          - task: UsePythonVersion@0
            inputs:
              versionSpec: '3.9'
          - template: templates/install-dependencies-steps.yml
          - script: inv setup -p snowflake -e pipeline
            displayName: "Setup harness"
          - script: inv run-integration-tests -s sats --subtype cycles -p snowflake
            displayName: "Run feature files"
            env:
              PIPELINE_JOB: $(Agent.JobName)

      - job: 'sats_incremental'
        displayName: 'Sats Incremental'
        steps:
          - task: UsePythonVersion@0
            inputs:
              versionSpec: '3.9'
          - template: templates/install-dependencies-steps.yml
          - script: inv setup -p snowflake -e pipeline
            displayName: "Setup harness"
          - script: inv run-integration-tests -s sats --subtype incremental -p snowflake
            displayName: "Run feature files"
            env:
              PIPELINE_JOB: $(Agent.JobName)

      - job: 'sats_pm'
        displayName: 'Sats PM'
        steps:
          - task: UsePythonVersion@0
            inputs:
              versionSpec: '3.9'
          - template: templates/install-dependencies-steps.yml
          - script: inv setup -p snowflake -e pipeline
            displayName: "Setup harness"
          - script: inv run-integration-tests -s sats --subtype pm -p snowflake
            displayName: "Run feature files"
            env:
              PIPELINE_JOB: $(Agent.JobName)

      - job: 'sats_rm'
        displayName: 'Sats RM'
        steps:
          - task: UsePythonVersion@0
            inputs:
              versionSpec: '3.9'
          - template: templates/install-dependencies-steps.yml
          - script: inv setup -p snowflake -e pipeline
            displayName: "Setup harness"
          - script: inv run-integration-tests -s sats --subtype rank -p snowflake
            displayName: "Run feature files"
            env:
              PIPELINE_JOB: $(Agent.JobName)

      - job: 'eff_sats_main'
        displayName: 'Eff Sats Main'
        steps:
          - task: UsePythonVersion@0
            inputs:
              versionSpec: '3.9'
          - template: templates/install-dependencies-steps.yml
          - script: inv setup -p snowflake -e pipeline
            displayName: "Setup harness"
          - script: inv run-integration-tests -s eff_sats --subtype main -p snowflake
            displayName: "Run feature files"
            env:
              PIPELINE_JOB: $(Agent.JobName)

      - job: 'eff_sats_auto'
        displayName: 'Eff Sats Auto'
        steps:
          - task: UsePythonVersion@0
            inputs:
              versionSpec: '3.9'
          - template: templates/install-dependencies-steps.yml
          - script: inv setup -p snowflake -e pipeline
            displayName: "Setup harness"
          - script: inv run-integration-tests -s eff_sats --subtype auto -p snowflake
            displayName: "Run feature files"
            env:
              PIPELINE_JOB: $(Agent.JobName)

      - job: 'eff_sats_disabled'
        displayName: 'Eff Sats Disabled Auto End-dating'
        steps:
          - task: UsePythonVersion@0
            inputs:
              versionSpec: '3.9'
          - template: templates/install-dependencies-steps.yml
          - script: inv setup -p snowflake -e pipeline
            displayName: "Setup harness"
          - script: inv run-integration-tests -s eff_sats --subtype disabled -p snowflake
            displayName: "Run feature files"
            env:
              PIPELINE_JOB: $(Agent.JobName)

      - job: 'eff_sats_mat'
        displayName: 'Eff Sats Mat'
        steps:
          - task: UsePythonVersion@0
            inputs:
              versionSpec: '3.9'
          - template: templates/install-dependencies-steps.yml
          - script: inv setup -p snowflake -e pipeline
            displayName: "Setup harness"
          - script: inv run-integration-tests -s eff_sats --subtype mat -p snowflake
            displayName: "Run feature files"
            env:
              PIPELINE_JOB: $(Agent.JobName)

      - job: 'ma_sats_1cdk'
        displayName: 'MA Sats 1CDK'
        steps:
          - task: UsePythonVersion@0
            inputs:
              versionSpec: '3.9'
          - template: templates/install-dependencies-steps.yml
          - script: inv setup -p snowflake -e pipeline
            displayName: "Setup harness"
          - script: inv run-integration-tests -s ma_sats --subtype 1cdk -p snowflake
            displayName: "Run feature files"
            env:
              PIPELINE_JOB: $(Agent.JobName)

      - job: 'ma_sats_1cdk_cyc'
        displayName: 'MA Sats 1CDK-Cycles'
        steps:
          - task: UsePythonVersion@0
            inputs:
              versionSpec: '3.9'
          - template: templates/install-dependencies-steps.yml
          - script: inv setup -p snowflake -e pipeline
            displayName: "Setup harness"
          - script: inv run-integration-tests -s ma_sats --subtype 1cdk_cycles -p snowflake
            displayName: "Run feature files"
            env:
              PIPELINE_JOB: $(Agent.JobName)

      - job: 'ma_sats_2cdk'
        displayName: 'MA Sats 2CDK'
        steps:
          - task: UsePythonVersion@0
            inputs:
              versionSpec: '3.9'
          - template: templates/install-dependencies-steps.yml
          - script: inv setup -p snowflake -e pipeline
            displayName: "Setup harness"
          - script: inv run-integration-tests -s ma_sats --subtype 2cdk -p snowflake
            displayName: "Run feature files"
            env:
              PIPELINE_JOB: $(Agent.JobName)

      - job: 'ma_sats_2cdk_cyc'
        displayName: 'MA Sats 2CDK-Cycles'
        steps:
          - task: UsePythonVersion@0
            inputs:
              versionSpec: '3.9'
          - template: templates/install-dependencies-steps.yml
          - script: inv setup -p snowflake -e pipeline
            displayName: "Setup harness"
          - script: inv run-integration-tests -s ma_sats --subtype 2cdk_cycles -p snowflake
            displayName: "Run feature files"
            env:
              PIPELINE_JOB: $(Agent.JobName)

      - job: 'ma_sats_incremental'
        displayName: 'MA Sats Incremental'
        steps:
          - task: UsePythonVersion@0
            inputs:
              versionSpec: '3.9'
          - template: templates/install-dependencies-steps.yml
          - script: inv setup -p snowflake -e pipeline
            displayName: "Setup harness"
          - script: inv run-integration-tests -s ma_sats --subtype incremental -p snowflake
            displayName: "Run feature files"
            env:
              PIPELINE_JOB: $(Agent.JobName)

      - job: 'ma_sats_pm'
        displayName: 'MA Sats PM'
        steps:
          - task: UsePythonVersion@0
            inputs:
              versionSpec: '3.9'
          - template: templates/install-dependencies-steps.yml
          - script: inv setup -p snowflake -e pipeline
            displayName: "Setup harness"
          - script: inv run-integration-tests -s ma_sats --subtype pm -p snowflake
            displayName: "Run feature files"
            env:
              PIPELINE_JOB: $(Agent.JobName)

      - job: 'ma_sats_rm'
        displayName: 'MA Sats RM'
        steps:
          - task: UsePythonVersion@0
            inputs:
              versionSpec: '3.9'
          - template: templates/install-dependencies-steps.yml
          - script: inv setup -p snowflake -e pipeline
            displayName: "Setup harness"
          - script: inv run-integration-tests -s ma_sats --subtype rm -p snowflake
            displayName: "Run feature files"
            env:
              PIPELINE_JOB: $(Agent.JobName)

      - job: 'ma_sats_rm_dup'
        displayName: 'MA Sats RM Duplicates'
        steps:
          - task: UsePythonVersion@0
            inputs:
              versionSpec: '3.9'
          - template: templates/install-dependencies-steps.yml
          - script: inv setup -p snowflake -e pipeline
            displayName: "Setup harness"
          - script: inv run-integration-tests -s ma_sats --subtype rm_dup -p snowflake
            displayName: "Run feature files"
            env:
              PIPELINE_JOB: $(Agent.JobName)

      - job: 'xts_main'
        displayName: 'XT Sats - Main'
        steps:
          - task: UsePythonVersion@0
            inputs:
              versionSpec: '3.9'
          - template: templates/install-dependencies-steps.yml
          - script: inv setup -p snowflake -e pipeline
            displayName: "Setup harness"
          - script: inv run-integration-tests -s xts --subtype main -p snowflake
            displayName: "Run feature files"
            env:
              PIPELINE_JOB: $(Agent.JobName)

      - job: 'xts_inc'
        displayName: 'XT Sats - Incremental'
        steps:
          - task: UsePythonVersion@0
            inputs:
              versionSpec: '3.9'
          - template: templates/install-dependencies-steps.yml
          - script: inv setup -p snowflake -e pipeline
            displayName: "Setup harness"
          - script: inv run-integration-tests -s xts --subtype incremental -p snowflake
            displayName: "Run feature files"
            env:
              PIPELINE_JOB: $(Agent.JobName)

      - job: 'pit_main'
        displayName: 'PITs Main'
        steps:
          - task: UsePythonVersion@0
            inputs:
              versionSpec: '3.9'
          - template: templates/install-dependencies-steps.yml
          - script: inv setup -p snowflake -e pipeline
            displayName: "Setup harness"
          - script: inv run-integration-tests -s pit --subtype main -p snowflake
            displayName: "Run feature files"
            env:
              PIPELINE_JOB: $(Agent.JobName)

      - job: 'pit_1sat_base'
        displayName: 'PITs 1 Sat Base'
        steps:
          - task: UsePythonVersion@0
            inputs:
              versionSpec: '3.9'
          - template: templates/install-dependencies-steps.yml
          - script: inv setup -p snowflake -e pipeline
            displayName: "Setup harness"
          - script: inv run-integration-tests -s pit --subtype 1sat_base -p snowflake
            displayName: "Run feature files"
            env:
              PIPELINE_JOB: $(Agent.JobName)

      - job: 'pit_1sat_inc'
        displayName: 'PITs 1 Sat Incremental'
        steps:
          - task: UsePythonVersion@0
            inputs:
              versionSpec: '3.9'
          - template: templates/install-dependencies-steps.yml
          - script: inv setup -p snowflake -e pipeline
            displayName: "Setup harness"
          - script: inv run-integration-tests -s pit --subtype 1sat_inc -p snowflake
            displayName: "Run feature files"
            env:
              PIPELINE_JOB: $(Agent.JobName)

      - job: 'pit_2sat'
        displayName: 'PITs 2 Sat'
        steps:
          - task: UsePythonVersion@0
            inputs:
              versionSpec: '3.9'
          - template: templates/install-dependencies-steps.yml
          - script: inv setup -p snowflake -e pipeline
            displayName: "Setup harness"
          - script: inv run-integration-tests -s pit --subtype 2sat -p snowflake
            displayName: "Run feature files"
            env:
              PIPELINE_JOB: $(Agent.JobName)

      - job: 'bridge_inc'
        displayName: 'Bridges Incremental'
        steps:
          - task: UsePythonVersion@0
            inputs:
              versionSpec: '3.9'
          - template: templates/install-dependencies-steps.yml
          - script: inv setup -p snowflake -e pipeline
            displayName: "Setup harness"
          - script: inv run-integration-tests -s bridge --subtype inc -p snowflake
            displayName: "Run feature files"
            env:
              PIPELINE_JOB: $(Agent.JobName)

      - job: 'bridge_1link'
        displayName: 'Bridges 1Link'
        steps:
          - task: UsePythonVersion@0
            inputs:
              versionSpec: '3.9'
          - template: templates/install-dependencies-steps.yml
          - script: inv setup -p snowflake -e pipeline
            displayName: "Setup harness"
          - script: inv run-integration-tests -s bridge --subtype 1link -p snowflake
            displayName: "Run feature files"
            env:
              PIPELINE_JOB: $(Agent.JobName)

      - job: 'bridge_2link'
        displayName: 'Bridges 2Link'
        steps:
          - task: UsePythonVersion@0
            inputs:
              versionSpec: '3.9'
          - template: templates/install-dependencies-steps.yml
          - script: inv setup -p snowflake -e pipeline
            displayName: "Setup harness"
          - script: inv run-integration-tests -s bridge --subtype 2link -p snowflake
            displayName: "Run feature files"
            env:
              PIPELINE_JOB: $(Agent.JobName)

      - job: 'bridge_3link'
        displayName: 'Bridges 3Link'
        steps:
          - task: UsePythonVersion@0
            inputs:
              versionSpec: '3.9'
          - template: templates/install-dependencies-steps.yml
          - script: inv setup -p snowflake -e pipeline
            displayName: "Setup harness"
          - script: inv run-integration-tests -s bridge --subtype 3link -p snowflake
            displayName: "Run feature files"
            env:
              PIPELINE_JOB: $(Agent.JobName)

      - job: 'cycle'
        displayName: 'Cycles'
        steps:
          - task: UsePythonVersion@0
            inputs:
              versionSpec: '3.9'
          - template: templates/install-dependencies-steps.yml
          - script: inv setup -p snowflake -e pipeline
            displayName: "Setup harness"
          - script: inv run-integration-tests -s cycle -p snowflake
            displayName: "Run feature files"
            env:
              PIPELINE_JOB: $(Agent.JobName)

  - stage: 'integration_tests_bigquery'
    displayName: 'Run Integration Tests (BigQuery)'
    jobs:
     - job: 'staging'
       displayName: 'Staging'
       steps:
         - task: UsePythonVersion@0
           inputs:
             versionSpec: '3.9'
         - template: templates/install-dependencies-steps.yml
         - script: inv setup -p bigquery -e pipeline
           displayName: "Setup harness"
         - script: inv run-integration-tests -s staging -p bigquery
           displayName: "Run feature files"
           env:
             PIPELINE_JOB: $(Agent.JobName)

     - job: 'hubs_main'
       displayName: 'Hubs Main'
       steps:
         - task: UsePythonVersion@0
           inputs:
             versionSpec: '3.9'
         - template: templates/install-dependencies-steps.yml
         - script: inv setup -p bigquery -e pipeline
           displayName: "Setup harness"
         - script: inv run-integration-tests -s hubs --subtype main -p bigquery
           displayName: "Run feature files"
           env:
             PIPELINE_JOB: $(Agent.JobName)

     - job: 'hubs_comppk'
       displayName: 'Hubs Comp PK'
       steps:
         - task: UsePythonVersion@0
           inputs:
             versionSpec: '3.9'
         - template: templates/install-dependencies-steps.yml
         - script: inv setup -p bigquery -e pipeline
           displayName: "Setup harness"
         - script: inv run-integration-tests -s hubs --subtype comppk -p bigquery
           displayName: "Run feature files"
           env:
             PIPELINE_JOB: $(Agent.JobName)

     - job: 'hubs_incremental'
       displayName: 'Hubs Incremental'
       steps:
         - task: UsePythonVersion@0
           inputs:
             versionSpec: '3.9'
         - template: templates/install-dependencies-steps.yml
         - script: inv setup -p bigquery -e pipeline
           displayName: "Setup harness"
         - script: inv run-integration-tests -s hubs --subtype incremental -p bigquery
           displayName: "Run feature files"
           env:
             PIPELINE_JOB: $(Agent.JobName)

     - job: 'hubs_pm'
       displayName: 'Hubs PM'
       steps:
         - task: UsePythonVersion@0
           inputs:
             versionSpec: '3.9'
         - template: templates/install-dependencies-steps.yml
         - script: inv setup -p bigquery -e pipeline
           displayName: "Setup harness"
         - script: inv run-integration-tests -s hubs --subtype pm -p bigquery
           displayName: "Run feature files"
           env:
             PIPELINE_JOB: $(Agent.JobName)

     - job: 'hubs_rm'
       displayName: 'Hubs RM'
       steps:
         - task: UsePythonVersion@0
           inputs:
             versionSpec: '3.9'
         - template: templates/install-dependencies-steps.yml
         - script: inv setup -p bigquery -e pipeline
           displayName: "Setup harness"
         - script: inv run-integration-tests -s hubs --subtype rank -p bigquery
           displayName: "Run feature files"
           env:
             PIPELINE_JOB: $(Agent.JobName)

     - job: 'links_main'
       displayName: 'Links Main'
       steps:
         - task: UsePythonVersion@0
           inputs:
             versionSpec: '3.9'
         - template: templates/install-dependencies-steps.yml
         - script: inv setup -p bigquery -e pipeline
           displayName: "Setup harness"
         - script: inv run-integration-tests -s links --subtype main -p bigquery
           displayName: "Run feature files"
           env:
             PIPELINE_JOB: $(Agent.JobName)

     - job: 'links_incremental'
       displayName: 'Links Incremental'
       steps:
         - task: UsePythonVersion@0
           inputs:
             versionSpec: '3.9'
         - template: templates/install-dependencies-steps.yml
         - script: inv setup -p bigquery -e pipeline
           displayName: "Setup harness"
         - script: inv run-integration-tests -s links --subtype incremental -p bigquery
           displayName: "Run feature files"
           env:
             PIPELINE_JOB: $(Agent.JobName)

     - job: 'links_pm'
       displayName: 'Links PM'
       steps:
         - task: UsePythonVersion@0
           inputs:
             versionSpec: '3.9'
         - template: templates/install-dependencies-steps.yml
         - script: inv setup -p bigquery -e pipeline
           displayName: "Setup harness"
         - script: inv run-integration-tests -s links --subtype pm -p bigquery
           displayName: "Run feature files"
           env:
             PIPELINE_JOB: $(Agent.JobName)

     - job: 'links_rm'
       displayName: 'Links RM'
       steps:
         - task: UsePythonVersion@0
           inputs:
             versionSpec: '3.9'
         - template: templates/install-dependencies-steps.yml
         - script: inv setup -p bigquery -e pipeline
           displayName: "Setup harness"
         - script: inv run-integration-tests -s links --subtype rank -p bigquery
           displayName: "Run feature files"
           env:
             PIPELINE_JOB: $(Agent.JobName)

     - job: 'tlinks'
       displayName: 'TLinks'
       steps:
         - task: UsePythonVersion@0
           inputs:
             versionSpec: '3.9'
         - template: templates/install-dependencies-steps.yml
         - script: inv setup -p bigquery -e pipeline
           displayName: "Setup harness"
         - script: inv run-integration-tests -s t_links -p bigquery
           displayName: "Run feature files"
           env:
             PIPELINE_JOB: $(Agent.JobName)

     - job: 'sats_main'
       displayName: 'Sats Main'
       steps:
         - task: UsePythonVersion@0
           inputs:
             versionSpec: '3.9'
         - template: templates/install-dependencies-steps.yml
         - script: inv setup -p bigquery -e pipeline
           displayName: "Setup harness"
         - script: inv run-integration-tests -s sats --subtype main -p bigquery
           displayName: "Run feature files"
           env:
             PIPELINE_JOB: $(Agent.JobName)

     - job: 'sats_cycles'
       displayName: 'Sats Cycles'
       steps:
         - task: UsePythonVersion@0
           inputs:
             versionSpec: '3.9'
         - template: templates/install-dependencies-steps.yml
         - script: inv setup -p bigquery -e pipeline
           displayName: "Setup harness"
         - script: inv run-integration-tests -s sats --subtype cycles -p bigquery
           displayName: "Run feature files"
           env:
             PIPELINE_JOB: $(Agent.JobName)

     - job: 'sats_incremental'
       displayName: 'Sats Incremental'
       steps:
         - task: UsePythonVersion@0
           inputs:
             versionSpec: '3.9'
         - template: templates/install-dependencies-steps.yml
         - script: inv setup -p bigquery -e pipeline
           displayName: "Setup harness"
         - script: inv run-integration-tests -s sats --subtype incremental -p bigquery
           displayName: "Run feature files"
           env:
             PIPELINE_JOB: $(Agent.JobName)

     - job: 'sats_pm'
       displayName: 'Sats PM'
       steps:
         - task: UsePythonVersion@0
           inputs:
             versionSpec: '3.9'
         - template: templates/install-dependencies-steps.yml
         - script: inv setup -p bigquery -e pipeline
           displayName: "Setup harness"
         - script: inv run-integration-tests -s sats --subtype pm -p bigquery
           displayName: "Run feature files"
           env:
             PIPELINE_JOB: $(Agent.JobName)

     - job: 'sats_rm'
       displayName: 'Sats RM'
       steps:
         - task: UsePythonVersion@0
           inputs:
             versionSpec: '3.9'
         - template: templates/install-dependencies-steps.yml
         - script: inv setup -p bigquery -e pipeline
           displayName: "Setup harness"
         - script: inv run-integration-tests -s sats --subtype rank -p bigquery
           displayName: "Run feature files"
           env:
             PIPELINE_JOB: $(Agent.JobName)

     - job: 'eff_sats_main'
       displayName: 'Eff Sats Main'
       steps:
         - task: UsePythonVersion@0
           inputs:
             versionSpec: '3.9'
         - template: templates/install-dependencies-steps.yml
         - script: inv setup -p bigquery -e pipeline
           displayName: "Setup harness"
         - script: inv run-integration-tests -s eff_sats --subtype main -p bigquery
           displayName: "Run feature files"
           env:
             PIPELINE_JOB: $(Agent.JobName)

     - job: 'eff_sats_auto'
       displayName: 'Eff Sats Auto'
       steps:
         - task: UsePythonVersion@0
           inputs:
             versionSpec: '3.9'
         - template: templates/install-dependencies-steps.yml
         - script: inv setup -p bigquery -e pipeline
           displayName: "Setup harness"
         - script: inv run-integration-tests -s eff_sats --subtype auto -p bigquery
           displayName: "Run feature files"
           env:
             PIPELINE_JOB: $(Agent.JobName)

     - job: 'eff_sats_disabled'
       displayName: 'Eff Sats Disabled Auto End-dating'
       steps:
         - task: UsePythonVersion@0
           inputs:
             versionSpec: '3.9'
         - template: templates/install-dependencies-steps.yml
         - script: inv setup -p bigquery -e pipeline
           displayName: "Setup harness"
         - script: inv run-integration-tests -s eff_sats --subtype disabled -p bigquery
           displayName: "Run feature files"
           env:
             PIPELINE_JOB: $(Agent.JobName)

     - job: 'eff_sats_mat'
       displayName: 'Eff Sats Mat'
       steps:
         - task: UsePythonVersion@0
           inputs:
             versionSpec: '3.9'
         - template: templates/install-dependencies-steps.yml
         - script: inv setup -p bigquery -e pipeline
           displayName: "Setup harness"
         - script: inv run-integration-tests -s eff_sats --subtype mat -p bigquery
           displayName: "Run feature files"
           env:
             PIPELINE_JOB: $(Agent.JobName)

     - job: 'ma_sats_1cdk'
       displayName: 'MA Sats 1CDK'
       steps:
         - task: UsePythonVersion@0
           inputs:
             versionSpec: '3.9'
         - template: templates/install-dependencies-steps.yml
         - script: inv setup -p bigquery -e pipeline
           displayName: "Setup harness"
         - script: inv run-integration-tests -s ma_sats --subtype 1cdk -p bigquery
           displayName: "Run feature files"
           env:
             PIPELINE_JOB: $(Agent.JobName)

     - job: 'ma_sats_1cdk_cyc'
       displayName: 'MA Sats 1CDK-Cycles'
       steps:
         - task: UsePythonVersion@0
           inputs:
             versionSpec: '3.9'
         - template: templates/install-dependencies-steps.yml
         - script: inv setup -p bigquery -e pipeline
           displayName: "Setup harness"
         - script: inv run-integration-tests -s ma_sats --subtype 1cdk_cycles -p bigquery
           displayName: "Run feature files"
           env:
             PIPELINE_JOB: $(Agent.JobName)

     - job: 'ma_sats_2cdk'
       displayName: 'MA Sats 2CDK'
       steps:
         - task: UsePythonVersion@0
           inputs:
             versionSpec: '3.9'
         - template: templates/install-dependencies-steps.yml
         - script: inv setup -p bigquery -e pipeline
           displayName: "Setup harness"
         - script: inv run-integration-tests -s ma_sats --subtype 2cdk -p bigquery
           displayName: "Run feature files"
           env:
             PIPELINE_JOB: $(Agent.JobName)

     - job: 'ma_sats_2cdk_cyc'
       displayName: 'MA Sats 2CDK-Cycles'
       steps:
         - task: UsePythonVersion@0
           inputs:
             versionSpec: '3.9'
         - template: templates/install-dependencies-steps.yml
         - script: inv setup -p bigquery -e pipeline
           displayName: "Setup harness"
         - script: inv run-integration-tests -s ma_sats --subtype 2cdk_cycles -p bigquery
           displayName: "Run feature files"
           env:
             PIPELINE_JOB: $(Agent.JobName)

     - job: 'ma_sats_incremental'
       displayName: 'MA Sats Incremental'
       steps:
         - task: UsePythonVersion@0
           inputs:
             versionSpec: '3.9'
         - template: templates/install-dependencies-steps.yml
         - script: inv setup -p bigquery -e pipeline
           displayName: "Setup harness"
         - script: inv run-integration-tests -s ma_sats --subtype incremental -p bigquery
           displayName: "Run feature files"
           env:
             PIPELINE_JOB: $(Agent.JobName)

     - job: 'ma_sats_pm'
       displayName: 'MA Sats PM'
       steps:
         - task: UsePythonVersion@0
           inputs:
             versionSpec: '3.9'
         - template: templates/install-dependencies-steps.yml
         - script: inv setup -p bigquery -e pipeline
           displayName: "Setup harness"
         - script: inv run-integration-tests -s ma_sats --subtype pm -p bigquery
           displayName: "Run feature files"
           env:
             PIPELINE_JOB: $(Agent.JobName)

     - job: 'ma_sats_rm'
       displayName: 'MA Sats RM'
       steps:
         - task: UsePythonVersion@0
           inputs:
             versionSpec: '3.9'
         - template: templates/install-dependencies-steps.yml
         - script: inv setup -p bigquery -e pipeline
           displayName: "Setup harness"
         - script: inv run-integration-tests -s ma_sats --subtype rm -p bigquery
           displayName: "Run feature files"
           env:
             PIPELINE_JOB: $(Agent.JobName)

     - job: 'ma_sats_rm_dup'
       displayName: 'MA Sats RM Duplicates'
       steps:
         - task: UsePythonVersion@0
           inputs:
             versionSpec: '3.9'
         - template: templates/install-dependencies-steps.yml
         - script: inv setup -p bigquery -e pipeline
           displayName: "Setup harness"
         - script: inv run-integration-tests -s ma_sats --subtype rm_dup -p bigquery
           displayName: "Run feature files"
           env:
             PIPELINE_JOB: $(Agent.JobName)

     - job: 'xts_main'
       displayName: 'XT Sats - Main'
       steps:
         - task: UsePythonVersion@0
           inputs:
             versionSpec: '3.9'
         - template: templates/install-dependencies-steps.yml
         - script: inv setup -p bigquery -e pipeline
           displayName: "Setup harness"
         - script: inv run-integration-tests -s xts --subtype main -p bigquery
           displayName: "Run feature files"
           env:
             PIPELINE_JOB: $(Agent.JobName)

     - job: 'xts_inc'
       displayName: 'XT Sats - Incremental'
       steps:
         - task: UsePythonVersion@0
           inputs:
             versionSpec: '3.9'
         - template: templates/install-dependencies-steps.yml
         - script: inv setup -p bigquery -e pipeline
           displayName: "Setup harness"
         - script: inv run-integration-tests -s xts --subtype incremental -p bigquery
           displayName: "Run feature files"
           env:
             PIPELINE_JOB: $(Agent.JobName)

     - job: 'pit_main'
       displayName: 'PITs Main'
       steps:
         - task: UsePythonVersion@0
           inputs:
             versionSpec: '3.9'
         - template: templates/install-dependencies-steps.yml
         - script: inv setup -p bigquery -e pipeline
           displayName: "Setup harness"
         - script: inv run-integration-tests -s pit --subtype main -p bigquery
           displayName: "Run feature files"
           env:
             PIPELINE_JOB: $(Agent.JobName)

     - job: 'pit_1sat_base'
       displayName: 'PITs 1 Sat Base'
       steps:
         - task: UsePythonVersion@0
           inputs:
             versionSpec: '3.9'
         - template: templates/install-dependencies-steps.yml
         - script: inv setup -p bigquery -e pipeline
           displayName: "Setup harness"
         - script: inv run-integration-tests -s pit --subtype 1sat_base -p bigquery
           displayName: "Run feature files"
           env:
             PIPELINE_JOB: $(Agent.JobName)

     - job: 'pit_1sat_inc'
       displayName: 'PITs 1 Sat Incremental'
       steps:
         - task: UsePythonVersion@0
           inputs:
             versionSpec: '3.9'
         - template: templates/install-dependencies-steps.yml
         - script: inv setup -p bigquery -e pipeline
           displayName: "Setup harness"
         - script: inv run-integration-tests -s pit --subtype 1sat_inc -p bigquery
           displayName: "Run feature files"
           env:
             PIPELINE_JOB: $(Agent.JobName)

     - job: 'pit_2sat'
       displayName: 'PITs 2 Sat'
       steps:
         - task: UsePythonVersion@0
           inputs:
             versionSpec: '3.9'
         - template: templates/install-dependencies-steps.yml
         - script: inv setup -p bigquery -e pipeline
           displayName: "Setup harness"
         - script: inv run-integration-tests -s pit --subtype 2sat -p bigquery
           displayName: "Run feature files"
           env:
             PIPELINE_JOB: $(Agent.JobName)

     - job: 'bridge_inc'
       displayName: 'Bridges Incremental'
       steps:
         - task: UsePythonVersion@0
           inputs:
             versionSpec: '3.9'
         - template: templates/install-dependencies-steps.yml
         - script: inv setup -p bigquery -e pipeline
           displayName: "Setup harness"
         - script: inv run-integration-tests -s bridge --subtype inc -p bigquery
           displayName: "Run feature files"
           env:
             PIPELINE_JOB: $(Agent.JobName)

     - job: 'bridge_1link'
       displayName: 'Bridges 1Link'
       steps:
         - task: UsePythonVersion@0
           inputs:
             versionSpec: '3.9'
         - template: templates/install-dependencies-steps.yml
         - script: inv setup -p bigquery -e pipeline
           displayName: "Setup harness"
         - script: inv run-integration-tests -s bridge --subtype 1link -p bigquery
           displayName: "Run feature files"
           env:
             PIPELINE_JOB: $(Agent.JobName)

     - job: 'bridge_2link'
       displayName: 'Bridges 2Link'
       steps:
         - task: UsePythonVersion@0
           inputs:
             versionSpec: '3.9'
         - template: templates/install-dependencies-steps.yml
         - script: inv setup -p bigquery -e pipeline
           displayName: "Setup harness"
         - script: inv run-integration-tests -s bridge --subtype 2link -p bigquery
           displayName: "Run feature files"
           env:
             PIPELINE_JOB: $(Agent.JobName)

     - job: 'bridge_3link'
       displayName: 'Bridges 3Link'
       steps:
         - task: UsePythonVersion@0
           inputs:
             versionSpec: '3.9'
         - template: templates/install-dependencies-steps.yml
         - script: inv setup -p bigquery -e pipeline
           displayName: "Setup harness"
         - script: inv run-integration-tests -s bridge --subtype 3link -p bigquery
           displayName: "Run feature files"
           env:
             PIPELINE_JOB: $(Agent.JobName)

     - job: 'cycle'
       displayName: 'Cycles'
       steps:
         - task: UsePythonVersion@0
           inputs:
             versionSpec: '3.9'
         - template: templates/install-dependencies-steps.yml
         - script: inv setup -p bigquery -e pipeline
           displayName: "Setup harness"
         - script: inv run-integration-tests -s cycle -p bigquery
           displayName: "Run feature files"
           env:
             PIPELINE_JOB: $(Agent.JobName)
