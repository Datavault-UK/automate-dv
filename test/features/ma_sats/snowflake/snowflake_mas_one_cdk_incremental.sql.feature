Feature: [SF-MAS-1CD-INC] Multi Active Satellites

  @fixture.multi_active_satellite
  Scenario: [SF-MAS-1CD-INC-01] Load empty stage into a non existent multi-active satellite - one cycle
        Given the MULTI_ACTIVE_SATELLITE table does not exist
    And the RAW_STAGE table contains data
      | CUSTOMER_ID | CUSTOMER_NAME | CUSTOMER_PHONE  | LOAD_DATE  | SOURCE |
      | 1001        | Alice         | 17-214-233-1214 | 1993-01-01 | *      |
      | 1001        | Alice         | 17-214-233-1224 | 1993-01-01 | *      |
      | 1001        | Alice         | 17-214-233-1234 | 1993-01-01 | *      |
      | 1002        | Bob           | 17-214-233-1215 | 1993-01-01 | *      |
      | 1002        | Bob           | 17-214-233-1225 | 1993-01-01 | *      |
      | 1002        | Bob           | 17-214-233-1235 | 1993-01-01 | *      |
      | 1003        | Chad          | 17-214-233-1216 | 1993-01-01 | *      |
      | 1003        | Chad          | 17-214-233-1226 | 1993-01-01 | *      |
      | 1003        | Chad          | 17-214-233-1236 | 1993-01-01 | *      |
      | 1005        | Eric          | 17-214-233-1217 | 1993-01-01 | *      |
      | 1005        | Eric          | 17-214-233-1227 | 1993-01-01 | *      |
      | 1005        | Eric          | 17-214-233-1237 | 1993-01-01 | *      |
    And I stage the STG_CUSTOMER data
    And I load the MULTI_ACTIVE_SATELLITE ma_sat
    And the RAW_STAGE table contains data
      | CUSTOMER_ID | CUSTOMER_NAME | CUSTOMER_PHONE  | LOAD_DATE  | SOURCE |
    And I stage the STG_CUSTOMER data
    When I load the MULTI_ACTIVE_SATELLITE ma_sat
    Then the MULTI_ACTIVE_SATELLITE table should contain expected data
      | CUSTOMER_PK | CUSTOMER_NAME | CUSTOMER_PHONE  | HASHDIFF                                | EFFECTIVE_FROM | LOAD_DATE  | SOURCE |
      | md5('1001') | Alice         | 17-214-233-1214 | md5('1001\|\|ALICE\|\|17-214-233-1214') | 1993-01-01     | 1993-01-01 | *      |
      | md5('1001') | Alice         | 17-214-233-1224 | md5('1001\|\|ALICE\|\|17-214-233-1224') | 1993-01-01     | 1993-01-01 | *      |
      | md5('1001') | Alice         | 17-214-233-1234 | md5('1001\|\|ALICE\|\|17-214-233-1234') | 1993-01-01     | 1993-01-01 | *      |
      | md5('1002') | Bob           | 17-214-233-1215 | md5('1002\|\|BOB\|\|17-214-233-1215')   | 1993-01-01     | 1993-01-01 | *      |
      | md5('1002') | Bob           | 17-214-233-1225 | md5('1002\|\|BOB\|\|17-214-233-1225')   | 1993-01-01     | 1993-01-01 | *      |
      | md5('1002') | Bob           | 17-214-233-1235 | md5('1002\|\|BOB\|\|17-214-233-1235')   | 1993-01-01     | 1993-01-01 | *      |
      | md5('1003') | Chad          | 17-214-233-1216 | md5('1003\|\|CHAD\|\|17-214-233-1216')  | 1993-01-01     | 1993-01-01 | *      |
      | md5('1003') | Chad          | 17-214-233-1226 | md5('1003\|\|CHAD\|\|17-214-233-1226')  | 1993-01-01     | 1993-01-01 | *      |
      | md5('1003') | Chad          | 17-214-233-1236 | md5('1003\|\|CHAD\|\|17-214-233-1236')  | 1993-01-01     | 1993-01-01 | *      |
      | md5('1005') | Eric          | 17-214-233-1217 | md5('1005\|\|ERIC\|\|17-214-233-1217')  | 1993-01-01     | 1993-01-01 | *      |
      | md5('1005') | Eric          | 17-214-233-1227 | md5('1005\|\|ERIC\|\|17-214-233-1227')  | 1993-01-01     | 1993-01-01 | *      |
      | md5('1005') | Eric          | 17-214-233-1237 | md5('1005\|\|ERIC\|\|17-214-233-1237')  | 1993-01-01     | 1993-01-01 | *      |

  @fixture.multi_active_satellite
  Scenario: [SF-MAS-1CD-INC-02] Load data into a non existent multi-active satellite - one cycle
    Given the MULTI_ACTIVE_SATELLITE table does not exist
    And the RAW_STAGE table contains data
      | CUSTOMER_ID | CUSTOMER_NAME | CUSTOMER_PHONE  | LOAD_DATE  | SOURCE |
      | 1001        | Alice         | 17-214-233-1214 | 1993-01-01 | *      |
      | 1001        | Alice         | 17-214-233-1224 | 1993-01-01 | *      |
      | 1001        | Alice         | 17-214-233-1234 | 1993-01-01 | *      |
      | 1002        | Bob           | 17-214-233-1215 | 1993-01-01 | *      |
      | 1002        | Bob           | 17-214-233-1225 | 1993-01-01 | *      |
      | 1002        | Bob           | 17-214-233-1235 | 1993-01-01 | *      |
      | 1003        | Chad          | 17-214-233-1216 | 1993-01-01 | *      |
      | 1003        | Chad          | 17-214-233-1226 | 1993-01-01 | *      |
      | 1003        | Chad          | 17-214-233-1236 | 1993-01-01 | *      |
      | 1005        | Eric          | 17-214-233-1217 | 1993-01-01 | *      |
      | 1005        | Eric          | 17-214-233-1227 | 1993-01-01 | *      |
      | 1005        | Eric          | 17-214-233-1237 | 1993-01-01 | *      |
    And I stage the STG_CUSTOMER data
    And I load the MULTI_ACTIVE_SATELLITE ma_sat
    And the RAW_STAGE table contains data
      | CUSTOMER_ID | CUSTOMER_NAME | CUSTOMER_PHONE  | LOAD_DATE  | SOURCE |
      | 1002        | Bob           | 17-214-233-1215 | 1993-01-02 | *      |
      | 1002        | Bob           | 17-214-233-1225 | 1993-01-02 | *      |
      | 1002        | Bob           | 17-214-233-1235 | 1993-01-02 | *      |
      | 1001        | Alicia        | 17-214-233-1214 | 1993-01-02 | *      |
      | 1001        | Alice         | 17-214-233-1224 | 1993-01-02 | *      |
      | 1001        | Alice         | 17-214-233-1234 | 1993-01-02 | *      |
      | 1003        | Chad          | 17-214-233-1216 | 1993-01-02 | *      |
      | 1005        | Erik          | 17-214-233-1217 | 1993-01-02 | *      |
      | 1005        | Erik          | 17-214-233-1227 | 1993-01-02 | *      |
      | 1005        | Erik          | 17-214-233-1237 | 1993-01-02 | *      |
      | 1006        | Dan           | 17-214-233-1250 | 1993-01-02 | *      |
      | 1006        | Danny         | 17-214-233-1250 | 1993-01-02 | *      |
      | 1006        | Dan           | 17-214-233-1260 | 1993-01-02 | *      |
    And I stage the STG_CUSTOMER data
    When I load the MULTI_ACTIVE_SATELLITE ma_sat
    Then the MULTI_ACTIVE_SATELLITE table should contain expected data
      | CUSTOMER_PK | CUSTOMER_NAME | CUSTOMER_PHONE  | HASHDIFF                                | EFFECTIVE_FROM | LOAD_DATE  | SOURCE |
      | md5('1001') | Alice         | 17-214-233-1214 | md5('1001\|\|ALICE\|\|17-214-233-1214') | 1993-01-01     | 1993-01-01 | *      |
      | md5('1001') | Alice         | 17-214-233-1224 | md5('1001\|\|ALICE\|\|17-214-233-1224') | 1993-01-01     | 1993-01-01 | *      |
      | md5('1001') | Alice         | 17-214-233-1234 | md5('1001\|\|ALICE\|\|17-214-233-1234') | 1993-01-01     | 1993-01-01 | *      |
      | md5('1001') | Alicia        | 17-214-233-1214 | md5('1001\|\|ALICIA\|\|17-214-233-1214')| 1993-01-02     | 1993-01-02 | *      |
      | md5('1001') | Alice         | 17-214-233-1224 | md5('1001\|\|ALICE\|\|17-214-233-1224') | 1993-01-02     | 1993-01-02 | *      |
      | md5('1001') | Alice         | 17-214-233-1234 | md5('1001\|\|ALICE\|\|17-214-233-1234') | 1993-01-02     | 1993-01-02 | *      |
      | md5('1002') | Bob           | 17-214-233-1215 | md5('1002\|\|BOB\|\|17-214-233-1215')   | 1993-01-01     | 1993-01-01 | *      |
      | md5('1002') | Bob           | 17-214-233-1225 | md5('1002\|\|BOB\|\|17-214-233-1225')   | 1993-01-01     | 1993-01-01 | *      |
      | md5('1002') | Bob           | 17-214-233-1235 | md5('1002\|\|BOB\|\|17-214-233-1235')   | 1993-01-01     | 1993-01-01 | *      |
      | md5('1003') | Chad          | 17-214-233-1216 | md5('1003\|\|CHAD\|\|17-214-233-1216')  | 1993-01-01     | 1993-01-01 | *      |
      | md5('1003') | Chad          | 17-214-233-1226 | md5('1003\|\|CHAD\|\|17-214-233-1226')  | 1993-01-01     | 1993-01-01 | *      |
      | md5('1003') | Chad          | 17-214-233-1236 | md5('1003\|\|CHAD\|\|17-214-233-1236')  | 1993-01-01     | 1993-01-01 | *      |
      | md5('1003') | Chad          | 17-214-233-1216 | md5('1003\|\|CHAD\|\|17-214-233-1216')  | 1993-01-02     | 1993-01-02 | *      |
      | md5('1005') | Eric          | 17-214-233-1217 | md5('1005\|\|ERIC\|\|17-214-233-1217')  | 1993-01-01     | 1993-01-01 | *      |
      | md5('1005') | Eric          | 17-214-233-1227 | md5('1005\|\|ERIC\|\|17-214-233-1227')  | 1993-01-01     | 1993-01-01 | *      |
      | md5('1005') | Eric          | 17-214-233-1237 | md5('1005\|\|ERIC\|\|17-214-233-1237')  | 1993-01-01     | 1993-01-01 | *      |
      | md5('1005') | Erik          | 17-214-233-1217 | md5('1005\|\|ERIK\|\|17-214-233-1217')  | 1993-01-02     | 1993-01-02 | *      |
      | md5('1005') | Erik          | 17-214-233-1227 | md5('1005\|\|ERIK\|\|17-214-233-1227')  | 1993-01-02     | 1993-01-02 | *      |
      | md5('1005') | Erik          | 17-214-233-1237 | md5('1005\|\|ERIK\|\|17-214-233-1237')  | 1993-01-02     | 1993-01-02 | *      |
      | md5('1006') | Dan           | 17-214-233-1250 | md5('1006\|\|DAN\|\|17-214-233-1250')   | 1993-01-02     | 1993-01-02 | *      |
      | md5('1006') | Danny         | 17-214-233-1250 | md5('1006\|\|DANNY\|\|17-214-233-1250') | 1993-01-02     | 1993-01-02 | *      |
      | md5('1006') | Dan           | 17-214-233-1260 | md5('1006\|\|DAN\|\|17-214-233-1260')   | 1993-01-02     | 1993-01-02 | *      |

#TODO: [SF-MAS-1CD-INC-03] failing at loading of the stage in the second cycle.
  @fixture.multi_active_satellite_cycle
  Scenario: [SF-MAS-1CD-INC-03] Load mixed data into a non existent multi-active satellite - two cycles
    Given the MULTI_ACTIVE_SATELLITE table does not exist
    When the RAW_STAGE is loaded
      | CUSTOMER_ID | CUSTOMER_NAME | CUSTOMER_PHONE  | EFFECTIVE_FROM | LOAD_DATE  | SOURCE |
      | 1001        | Alice         | 17-214-233-1214 | 1993-01-01     | 1993-01-01 | *      |
      | 1001        | Alice         | 17-214-233-1224 | 1993-01-01     | 1993-01-01 | *      |
      | 1001        | Alice         | 17-214-233-1234 | 1993-01-01     | 1993-01-01 | *      |
      | 1002        | Bob           | 17-214-233-1215 | 1993-01-01     | 1993-01-01 | *      |
      | 1002        | Bob           | 17-214-233-1225 | 1993-01-01     | 1993-01-01 | *      |
      | 1002        | Bob           | 17-214-233-1235 | 1993-01-01     | 1993-01-01 | *      |
      | 1003        | Chad          | 17-214-233-1216 | 1993-01-01     | 1993-01-01 | *      |
      | 1003        | Chad          | 17-214-233-1226 | 1993-01-01     | 1993-01-01 | *      |
      | 1003        | Chad          | 17-214-233-1236 | 1993-01-01     | 1993-01-01 | *      |
      | 1005        | Eric          | 17-214-233-1217 | 1993-01-01     | 1993-01-01 | *      |
      | 1005        | Eric          | 17-214-233-1227 | 1993-01-01     | 1993-01-01 | *      |
      | 1005        | Eric          | 17-214-233-1237 | 1993-01-01     | 1993-01-01 | *      |
    And I stage the STG_CUSTOMER data
    And I load the MULTI_ACTIVE_SATELLITE ma_sat
    When the RAW_STAGE is loaded
      | CUSTOMER_ID | CUSTOMER_NAME | CUSTOMER_PHONE  | EFFECTIVE_FROM | LOAD_DATE  | SOURCE |
      | 1002        | Bob           | 17-214-233-1215 | 1993-01-02     | 1993-01-02 | *      |
      | 1002        | Bob           | 17-214-233-1225 | 1993-01-02     | 1993-01-02 | *      |
      | 1002        | Bob           | 17-214-233-1235 | 1993-01-02     | 1993-01-02 | *      |
      | 1001        | Alicia        | 17-214-233-1214 | 1993-01-02     | 1993-01-02 | *      |
      | 1001        | Alice         | 17-214-233-1224 | 1993-01-02     | 1993-01-02 | *      |
      | 1001        | Alice         | 17-214-233-1234 | 1993-01-02     | 1993-01-02 | *      |
      | 1003        | Chad          | 17-214-233-1216 | 1993-01-02     | 1993-01-02 | *      |
      | 1005        | Erik          | 17-214-233-1217 | 1993-01-02     | 1993-01-02 | *      |
      | 1005        | Erik          | 17-214-233-1227 | 1993-01-02     | 1993-01-02 | *      |
      | 1005        | Erik          | 17-214-233-1237 | 1993-01-02     | 1993-01-02 | *      |
      | 1006        | Dan           | 17-214-233-1250 | 1993-01-02     | 1993-01-02 | *      |
      | 1006        | Danny         | 17-214-233-1250 | 1993-01-02     | 1993-01-02 | *      |
      | 1006        | Dan           | 17-214-233-1260 | 1993-01-02     | 1993-01-02 | *      |
    And I stage the STG_CUSTOMER data
    And I load the MULTI_ACTIVE_SATELLITE ma_sat
    When the RAW_STAGE is loaded
      | CUSTOMER_ID | CUSTOMER_NAME | CUSTOMER_PHONE  | EFFECTIVE_FROM | LOAD_DATE  | SOURCE |
      | 1003        | Chad          | 17-214-233-1216 | 1993-01-03     | 1993-01-03 | *      |
      | 1003        | Chad          | 17-214-233-1226 | 1993-01-03     | 1993-01-03 | *      |
      | 1003        | Chad          | 17-214-233-1236 | 1993-01-03     | 1993-01-03 | *      |
      | 1005        | Eric          | 17-214-233-1217 | 1993-01-03     | 1993-01-03 | *      |
      | 1005        | Eric          | 17-214-233-1227 | 1993-01-03     | 1993-01-03 | *      |
      | 1005        | Erik          | 17-214-233-1237 | 1993-01-03     | 1993-01-03 | *      |
      | 1007        | Sam           | 17-214-233-1251 | 1993-01-03     | 1993-01-03 | *      |
      | 1007        | Sam           | 17-214-233-1261 | 1993-01-03     | 1993-01-03 | *      |
      | 1007        | Sam           | 17-214-233-1271 | 1993-01-03     | 1993-01-03 | *      |
    And I stage the STG_CUSTOMER data
    When I load the MULTI_ACTIVE_SATELLITE ma_sat
    Then the MULTI_ACTIVE_SATELLITE table should contain expected data
      | CUSTOMER_PK | CUSTOMER_NAME | CUSTOMER_PHONE  | HASHDIFF                                  | EFFECTIVE_FROM | LOAD_DATE  | SOURCE |
      | md5('1001') | Alice         | 17-214-233-1214 | md5('1001\|\|ALICE\|\|17-214-233-1214')   | 1993-01-01     | 1993-01-01 | *      |
      | md5('1001') | Alice         | 17-214-233-1224 | md5('1001\|\|ALICE\|\|17-214-233-1224')   | 1993-01-01     | 1993-01-01 | *      |
      | md5('1001') | Alice         | 17-214-233-1234 | md5('1001\|\|ALICE\|\|17-214-233-1234')   | 1993-01-01     | 1993-01-01 | *      |
      | md5('1001') | Alicia        | 17-214-233-1214 | md5('1001\|\|ALICIA\|\|17-214-233-1214')  | 1993-01-02     | 1993-01-02 | *      |
      | md5('1001') | Alice         | 17-214-233-1224 | md5('1001\|\|ALICE\|\|17-214-233-1224')   | 1993-01-02     | 1993-01-02 | *      |
      | md5('1001') | Alice         | 17-214-233-1234 | md5('1001\|\|ALICE\|\|17-214-233-1234')   | 1993-01-02     | 1993-01-02 | *      |
      | md5('1002') | Bob           | 17-214-233-1215 | md5('1002\|\|BOB\|\|17-214-233-1215')     | 1993-01-01     | 1993-01-01 | *      |
      | md5('1002') | Bob           | 17-214-233-1225 | md5('1002\|\|BOB\|\|17-214-233-1225')     | 1993-01-01     | 1993-01-01 | *      |
      | md5('1002') | Bob           | 17-214-233-1235 | md5('1002\|\|BOB\|\|17-214-233-1235')     | 1993-01-01     | 1993-01-01 | *      |
      | md5('1003') | Chad          | 17-214-233-1216 | md5('1003\|\|CHAD\|\|17-214-233-1216')    | 1993-01-01     | 1993-01-01 | *      |
      | md5('1003') | Chad          | 17-214-233-1226 | md5('1003\|\|CHAD\|\|17-214-233-1226')    | 1993-01-01     | 1993-01-01 | *      |
      | md5('1003') | Chad          | 17-214-233-1236 | md5('1003\|\|CHAD\|\|17-214-233-1236')    | 1993-01-01     | 1993-01-01 | *      |
      | md5('1003') | Chad          | 17-214-233-1216 | md5('1003\|\|CHAD\|\|17-214-233-1216')    | 1993-01-02     | 1993-01-02 | *      |
      | md5('1003') | Chad          | 17-214-233-1216 | md5('1003\|\|CHAD\|\|17-214-233-1216')    | 1993-01-03     | 1993-01-03 | *      |
      | md5('1003') | Chad          | 17-214-233-1226 | md5('1003\|\|CHAD\|\|17-214-233-1226')    | 1993-01-03     | 1993-01-03 | *      |
      | md5('1003') | Chad          | 17-214-233-1236 | md5('1003\|\|CHAD\|\|17-214-233-1236')    | 1993-01-03     | 1993-01-03 | *      |
      | md5('1005') | Eric          | 17-214-233-1217 | md5('1005\|\|ERIC\|\|17-214-233-1217')    | 1993-01-01     | 1993-01-01 | *      |
      | md5('1005') | Eric          | 17-214-233-1227 | md5('1005\|\|ERIC\|\|17-214-233-1227')    | 1993-01-01     | 1993-01-01 | *      |
      | md5('1005') | Eric          | 17-214-233-1237 | md5('1005\|\|ERIC\|\|17-214-233-1237')    | 1993-01-01     | 1993-01-01 | *      |
      | md5('1005') | Erik          | 17-214-233-1217 | md5('1005\|\|ERIK\|\|17-214-233-1217')    | 1993-01-02     | 1993-01-02 | *      |
      | md5('1005') | Erik          | 17-214-233-1227 | md5('1005\|\|ERIK\|\|17-214-233-1227')    | 1993-01-02     | 1993-01-02 | *      |
      | md5('1005') | Erik          | 17-214-233-1237 | md5('1005\|\|ERIK\|\|17-214-233-1237')    | 1993-01-02     | 1993-01-02 | *      |
      | md5('1005') | Eric          | 17-214-233-1217 | md5('1005\|\|ERIC\|\|17-214-233-1217')    | 1993-01-03     | 1993-01-03 | *      |
      | md5('1005') | Eric          | 17-214-233-1227 | md5('1005\|\|ERIC\|\|17-214-233-1227')    | 1993-01-03     | 1993-01-03 | *      |
      | md5('1005') | Erik          | 17-214-233-1237 | md5('1005\|\|ERIK\|\|17-214-233-1237')    | 1993-01-03     | 1993-01-03 | *      |
      | md5('1006') | Dan           | 17-214-233-1250 | md5('1006\|\|DAN\|\|17-214-233-1250')     | 1993-01-02     | 1993-01-02 | *      |
      | md5('1006') | Danny         | 17-214-233-1250 | md5('1006\|\|DANNY\|\|17-214-233-1250')   | 1993-01-02     | 1993-01-02 | *      |
      | md5('1006') | Dan           | 17-214-233-1260 | md5('1006\|\|DAN\|\|17-214-233-1260')     | 1993-01-02     | 1993-01-02 | *      |
      | md5('1007') | Sam           | 17-214-233-1251 | md5('1007\|\|SAM\|\|17-214-233-1251') | 1993-01-03     | 1993-01-03 | *      |
      | md5('1007') | Sam           | 17-214-233-1261 | md5('1007\|\|SAM\|\|17-214-233-1261') | 1993-01-03     | 1993-01-03 | *      |
      | md5('1007') | Sam           | 17-214-233-1271 | md5('1007\|\|SAM\|\|17-214-233-1271') | 1993-01-03     | 1993-01-03 | *      |